<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>气候经济综合模拟系统</title>
    <script src="https://cdn.plot.ly/plotly-2.18.2.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 25px;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 18px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
            border: 1px solid #e0e6ed;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #2ecc71, #3498db, #9b59b6, #e74c3c);
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
            position: relative;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.3rem;
            font-weight: 700;
        }
        
        h1 small {
            display: block;
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-top: 8px;
            font-weight: 400;
        }
        
        .year-indicator {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 8px 18px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .control-panel {
            padding: 20px;
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
            border-radius: 15px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .control-panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .control-panel::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2ecc71, #3498db);
        }
        
        .control-panel label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1rem;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 12px 0;
            height: 12px;
            border-radius: 10px;
            background: #e0e7ff;
            outline: none;
            -webkit-appearance: none;
            accent-color: #2ecc71;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #2ecc71;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(46, 204, 113, 0.5);
            border: 3px solid white;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: white;
            font-size: 1rem;
            margin-top: 8px;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.2rem;
            display: inline-block;
            min-width: 65px;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }
        
        /* 调整图表容器高度 */
        .chart-container {
            height: 380px;
            padding: 20px;
            background: #fcfdfd;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e6eef2;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .chart-container:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            padding: 8px 0;
        }
        
        .chart-title::before {
            content: "";
            display: inline-block;
            width: 8px;
            height: 26px;
            background: #3498db;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .hover-info {
            position: absolute;
            background: rgba(255, 255, 255, 0.98);
            border: 1px solid #3498db;
            border-radius: 12px;
            padding: 12px 18px;
            font-size: 0.9rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            min-width: 200px;
            backdrop-filter: blur(5px);
        }
        
        .hover-info h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 6px;
            font-size: 1rem;
        }
        
        .hover-info p {
            margin: 6px 0;
            line-height: 1.4;
        }
        
        .hover-value {
            font-weight: bold;
            color: #e74c3c;
            float: right;
        }
        
        /* 公式说明部分样式调整 */
        .formula-section {
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 30px 0 15px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .formula-section h3 {
            color: #3498db;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.6rem;
            text-align: center;
            position: relative;
            padding-bottom: 12px;
        }
        
        .formula-section h3::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 2px;
        }
        
        .formula-columns {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
            column-gap: 35px;
            row-gap: 25px;
        }
        
        .formula-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
        }
        
        .formula-box:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        
        .formula-box h4 {
            color: #2c3e50;
            font-size: 1.3rem;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
        }
        
        .formula-box h4 i {
            font-size: 1.5rem;
            margin-right: 10px;
            color: #3498db;
        }
        
        .formula-equation {
            font-size: 1.2rem;
            text-align: center;
            padding: 18px;
            background: #f1f8ff;
            border-radius: 10px;
            margin: 12px 0;
            font-family: "Cambria Math", serif;
            border: 1px dashed #3498db;
        }
        
        .parameter-list {
            list-style-type: none;
            padding: 0;
        }
        
        .parameter-list li {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            transition: all 0.2s ease;
        }
        
        .parameter-list li:hover {
            background: #bbdefb;
            transform: translateX(4px);
        }
        
        .parameter-name {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .parameter-value {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .parameter-source {
            font-style: italic;
            color: #7f8c8d;
            font-size: 0.9rem;
            display: block;
            margin-top: 4px;
        }
        
        .parameter-source a {
            color: #3498db;
            text-decoration: none;
        }
        
        .parameter-source a:hover {
            text-decoration: underline;
        }
        
        .footer-note {
            text-align: center;
            color: #7f8c8d;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        /* 图表大小控制面板 */
        .chart-size-control {
            background: linear-gradient(135deg, #f5f7fa, #e4e7eb);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .chart-size-control h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.4rem;
        }
        
        .size-slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .size-slider-label {
            font-weight: 600;
            color: #2c3e50;
            min-width: 150px;
        }
        
        .size-slider {
            flex: 1;
        }
        
        .size-indicator {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            color: #e74c3c;
        }
        
        @media (max-width: 1200px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .formula-columns {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 320px;
            }
        }
        
        @media (max-width: 768px) {
            .header-section {
                flex-direction: column;
                text-align: center;
            }
            
            .year-indicator {
                margin-top: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .container {
                padding: 15px;
            }
            
            .size-slider-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .size-slider-label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <div>
                <h1>气候经济综合模拟系统
                    <small>1960-2100 科学模拟 |</small>
                </h1>
            </div>
            <div class="year-indicator">
                当前年份: <span id="currentYearDisplay">1960</span>
            </div>
        </div>
        
        <!-- 控制面板 -->
        <div class="control-grid">
            <div class="control-panel">
                <label>基础排放量 (Gt/yr):
                    <span id="baseEmissionVal" class="highlight">9.4</span>
                    <input type="range" id="baseEmission" min="5" max="20" value="9.4" step="0.1">
                </label>
                <div style="font-size: 0.95rem; color: #7f8c8d; margin-top: 8px;">参考值: 美国13.0吨/人</div>
            </div>
            <div class="control-panel">
                <label>减排力度 (%/年):
                    <span id="reductionVal" class="highlight">2</span>
                    <input type="range" id="reduction" min="0" max="5" value="2" step="0.1">
                </label>
                <div style="font-size: 0.95rem; color: #7f8c8d; margin-top: 8px;">0% = 无减排措施</div>
            </div>
            <div class="control-panel">
                <label>当前年份:
                    <span id="currentYearVal" class="highlight">1960</span>
                    <input type="range" id="currentYear" min="1960" max="2100" value="1960">
                </label>
                <div style="font-size: 0.95rem; color: #7f8c8d; margin-top: 8px;">拖动查看不同年份数据</div>
            </div>
            <div class="control-panel">
                <label>国家类型:
                    <select id="countryType" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem;">
                        <option value="developed">发达国家</option>
                        <option value="developing">发展中国家</option>
                    </select>
                </label>
                <div style="font-size: 0.95rem; color: #7f8c8d; margin-top: 8px;">不同国家模型参数不同</div>
            </div>
        </div>
        
        <!-- 图表大小控制 -->
        <div class="chart-size-control">
            <h3>图表大小调节</h3>
            <div class="size-slider-container">
                <div class="size-slider-label">图表高度调节:</div>
                <input type="range" id="chartHeightSlider" class="size-slider" min="300" max="500" value="380" step="10">
                <div class="size-indicator"><span id="chartHeightValue">380</span>px</div>
            </div>
            <div class="size-slider-container">
                <div class="size-slider-label">图表宽度比例:</div>
                <input type="range" id="chartWidthSlider" class="size-slider" min="40" max="100" value="100" step="5">
                <div class="size-indicator"><span id="chartWidthValue">100</span>%</div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="chart-grid">
            <div class="chart-container" id="emissionChart">
                <div class="chart-title">CO₂排放趋势 (Gt/yr)</div>
                <div class="hover-info" id="emissionHover"></div>
            </div>
            <div class="chart-container" id="concentrationChart">
                <div class="chart-title">大气CO₂浓度 (ppm)</div>
                <div class="hover-info" id="concentrationHover"></div>
            </div>
            <div class="chart-container" id="temperatureChart">
                <div class="chart-title">全球平均温升 (℃)</div>
                <div class="hover-info" id="temperatureHover"></div>
            </div>
            <div class="chart-container" id="economyChart">
                <div class="chart-title">人均GDP变化 (美元)</div>
                <div class="hover-info" id="economyHover"></div>
            </div>
        </div>

        <!-- 公式说明 -->
        <div class="formula-section">
            <h3>核心模型说明与参数来源</h3>
            <div class="formula-columns">
                <div class="formula-box">
                    <h4><i>📈</i>排放模型</h4>
                    <div class="formula-equation">
                        E(t) = E₀ × (1 - r/100)<sup>t</sup> × (1 + g)<sup>t</sup>
                    </div>
                    <ul class="parameter-list">
                        <li>
                            <span class="parameter-name">E₀</span>: 基础排放量 (Gt/yr)
                            <span class="parameter-source">用户设定参数，参考值来自<a href="https://www.globalcarbonproject.org/" target="_blank">全球碳计划</a></span>
                        </li>
                        <li>
                            <span class="parameter-name">r</span>: 年减排率 (%)
                            <span class="parameter-source">用户设定参数，参考<a href="https://unfccc.int/process-and-meetings/the-paris-agreement/the-paris-agreement" target="_blank">巴黎协定</a>目标</span>
                        </li>
                        <li>
                            <span class="parameter-name">g</span>: 经济自然增长率 (1%)
                            <span class="parameter-source">基于<a href="https://data.worldbank.org" target="_blank">世界银行</a>历史数据</span>
                        </li>
                        <li>
                            <span class="parameter-name">t</span>: 时间 (年)
                            <span class="parameter-source">模拟时间跨度1960-2100年</span>
                        </li>
                    </ul>
                </div>
                
                <div class="formula-box">
                    <h4><i>🌍</i>浓度模型</h4>
                    <div class="formula-equation">
                        C(t) = C(t-1) + E(t) × 0.44/2.12 - 0.005 × (C(t-1) - 280)
                    </div>
                    <ul class="parameter-list">
                        <li>
                            <span class="parameter-name">0.44</span>: 碳留存率
                            <span class="parameter-source">来自<a href="https://www.ipcc.ch/report/ar6/wg1/" target="_blank">IPCC AR6</a>报告</span>
                        </li>
                        <li>
                            <span class="parameter-name">2.12</span>: GtC到ppm转换系数
                            <span class="parameter-source">基于大气总碳量计算</span>
                        </li>
                        <li>
                            <span class="parameter-name">0.005</span>: 自然衰减率
                            <span class="parameter-source">基于碳循环模型</span>
                        </li>
                        <li>
                            <span class="parameter-name">280</span>: 工业革命前CO₂浓度 (ppm)
                            <span class="parameter-source"><a href="https://www.ncei.noaa.gov/products/paleoclimatology/ice-core" target="_blank">NOAA冰芯数据</a></span>
                        </li>
                    </ul>
                </div>
                
                <div class="formula-box">
                    <h4><i>🔥</i>温升模型</h4>
                    <div class="formula-equation">
                        ΔT = (Am × AT × ΔFs(CO₂)) / (4 × Kb × Ts³)
                    </div>
                    <ul class="parameter-list">
                        <li>
                            <span class="parameter-name">Am</span>: 模型因子 (2.3)
                            <span class="parameter-source">大气质量校正因子</span>
                        </li>
                        <li>
                            <span class="parameter-name">AT_val</span>: 模型因子 (6.6)
                            <span class="parameter-source">大气透射率校正因子</span>
                        </li>
                        <li>
                            <span class="parameter-name">ΔFs(CO₂)</span>: CO₂辐射强迫
                            <span class="parameter-source">由辐射强迫模型计算得出</span>
                        </li>
                        <li>
                            <span class="parameter-name">Kb</span>: 玻尔兹曼常数 (5.670367e-8 W/m²/K⁴)
                            <span class="parameter-source">物理学基本常数</span>
                        </li>
                        <li>
                            <span class="parameter-name">Ts</span>: 地表基准温度 (288.15K)
                            <span class="parameter-source"><a href="https://climate.nasa.gov/vital-signs/global-temperature/" target="_blank">NASA气候数据</a></span>
                        </li>
                    </ul>
                </div>
                
                <div class="formula-box">
                    <h4><i>💼</i>经济模型</h4>
                    <div class="formula-equation">
                        GDP(t) = GDP₀ × [1 - αΔT - βE(t)<sup>1.5</sup>]
                    </div>
                    <ul class="parameter-list">
                        <li>
                            <span class="parameter-name">GDP₀</span>: 初始人均GDP
                            <span class="parameter-source">发达国家: $18,000 | 发展中国家: $800 (<a href="https://data.worldbank.org" target="_blank">世界银行</a>)</span>
                        </li>
                        <li>
                            <span class="parameter-name">α</span>: 温升影响系数 (发达:0.021 | 发展:0.036)
                            <span class="parameter-source"><a href="https://nordhaus.yale.edu/dice-model" target="_blank">DICE模型</a>校准参数</span>
                        </li>
                        <li>
                            <span class="parameter-name">β</span>: 排放影响系数 (发达:0.0008 | 发展:0.0025)
                            <span class="parameter-source"><a href="https://nordhaus.yale.edu/dice-model" target="_blank">DICE模型</a>校准参数</span>
                        </li>
                        <li>
                            <span class="parameter-name">ΔT</span>: 全球温升 (℃)
                            <span class="parameter-source">来自温升模型输出</span>
                        </li>
                        <li>
                            <span class="parameter-name">E(t)</span>: 当前排放量 (Gt/yr)
                            <span class="parameter-source">来自排放模型输出</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="footer-note">
            <p>气候经济综合模拟系统 v2.1 | 基于科学文献的科普模型 </p>
            <p>注意：本模型为简化模拟，实际气候系统更为复杂。结果仅供参考和科普使用。</p>
        </div>
    </div>

<script>
// 辐射强迫数据（400个值，对应0-400ppm浓度变化）
const forcingData = [
    0.004254886414855719, 0.008499289862811565, 0.01271579787135124, 0.01693120412528515, 0.02112998627126217,
    0.02534418180584908, 0.02951076254248619, 0.03366575390100479, 0.037813451141119, 0.04194707050919533,
    0.0460711270570755, 0.0501839816570282, 0.05428701639175415, 0.05837531760334969, 0.06244532763957977,
    0.06651551276445389, 0.07056402415037155, 0.0746060386300087, 0.07863591611385345, 0.08266478031873703,
    0.08666979521512985, 0.09068613499403, 0.09469549357891083, 0.09881450980901718, 0.1027743443846703,
    0.1067359074950218, 0.1106703504920006, 0.1145982593297958, 0.1185198500752449, 0.1224455162882805,
    0.1263438612222672, 0.1302281767129898, 0.1341042667627335, 0.1379647701978683, 0.1418208032846451,
    0.1456635594367981, 0.1494986265897751, 0.1533304899930954, 0.1571452021598816, 0.1609409749507904,
    0.1647820472717285, 0.1685601323843002, 0.1723310053348541, 0.1761125028133392, 0.1798636019229889,
    0.1836036145687103, 0.187347412109375, 0.1910654604434967, 0.1947691589593887, 0.1984728574752808,
    0.2021667212247849, 0.2058592438697815, 0.209527462720871, 0.2131845951080322, 0.2168625891208649,
    0.2204902768135071, 0.2241183668375015, 0.2277448624372482, 0.2313620299100876, 0.2349733114242554,
    0.2385702431201935, 0.2421588450670242, 0.2457369863986969, 0.2493316978216171, 0.2529133856296539,
    0.2564589381217957, 0.260002464056015, 0.2635426223278046, 0.2670674622058868, 0.2705870270729065,
    0.2741129994392395, 0.2776466012001038, 0.2811551690101624, 0.2846325039863586, 0.2881049513816833,
    0.2915725409984589, 0.2950241565704346, 0.2984772920608521, 0.3019296824932098, 0.3053676187992096,
    0.3087970316410065, 0.3122057616710663, 0.3156109154224396, 0.3190184831619263, 0.3224059641361237,
    0.3257916569709778, 0.3291655480861664, 0.3325336575508118, 0.3359022736549377, 0.3392576277256012,
    0.3425960540771484, 0.345937043428421, 0.3492612242698669, 0.3525879681110382, 0.3559074103832245,
    0.3592154085636139, 0.3625055253505707, 0.3657999038696289, 0.3690805435180664, 0.3723615109920502,
    0.3756286203861237, 0.3788966834545135, 0.3821573257446289, 0.3854096531867981, 0.3886472880840302,
    0.3918772339820862, 0.3951053023338318, 0.398404985666275, 0.4015372395515442, 0.4047401547431946,
    0.4079436957836151, 0.4111275970935822, 0.4143101572990417, 0.4174891710281372, 0.4206519722938538,
    0.423809826374054, 0.426965206861496, 0.4300996363162994, 0.4332470297813416, 0.4363756775856018,
    0.4395062327384949, 0.4426243901252747, 0.4457430839538574, 0.4488482475280762, 0.4519462585449219,
    0.4550392031669617, 0.4581119120121002, 0.4612011015415192, 0.4642739295959473, 0.4673399031162262,
    0.470394104719162, 0.4734584093093872, 0.4765130877494812, 0.4795480668544769, 0.4825834929943085,
    0.4856105744838715, 0.4886462092399597, 0.4917071163654327, 0.4947156012058258, 0.4977212846279144,
    0.5008167028427124, 0.5038073658943176, 0.5067999958992004, 0.5097782015800476, 0.5127545595169067,
    0.5157296657562256, 0.5187463760375977, 0.5216995477676392, 0.5246509313583374, 0.5275945067405701,
    0.5305388569831848, 0.5334743857383728, 0.5364009141921997, 0.5393218994140625, 0.5422357320785522,
    0.5451427102088928, 0.5480458736419678, 0.5509449243545532, 0.5538314580917358, 0.5567227602005005,
    0.5596013069152832, 0.562476396560669, 0.5653466582298279, 0.5682097673416138, 0.5710659027099609,
    0.573917806148529, 0.5767682790756226, 0.5796175003051758, 0.5824547410011292, 0.585283100605011,
    0.5881136059761047, 0.5909330248832703, 0.5937502980232239, 0.596561849117279, 0.5993665456771851,
    0.602175235748291, 0.6049671769142151, 0.6077560782432556, 0.610543966293335, 0.6133226156234741,
    0.6160971522331238, 0.618872344493866, 0.6216357350349426, 0.6243925094604492, 0.6271597743034363,
    0.6299107670783997, 0.6326552033424377, 0.6353994607925415, 0.6381409168243408, 0.6408671736717224,
    0.6435896158218384, 0.6463119387626648, 0.649029552936554, 0.651739776134491, 0.6544536352157593,
    0.6571528315544128, 0.6598437428474426, 0.6625436544418335, 0.6652528047561646, 0.6679192185401917,
    0.6705968976020813, 0.6732682585716248, 0.6759376525878906, 0.6785967946052551, 0.6812611818313599,
    0.6839151382446289, 0.6865692734718323, 0.6892142295837402, 0.6918537020683289, 0.6945009231567383,
    0.6971370577812195, 0.6997657418251038, 0.702388346195221, 0.7050116062164307, 0.7076285481452942,
    0.7102370858192444, 0.7128481864929199, 0.7154561281204224, 0.7183200120925903, 0.7209081053733826,
    0.7235053181648254, 0.7260869145393372, 0.7286769151687622, 0.7312531471252441, 0.7338256239891052,
    0.7364180088043213, 0.7389892935752869, 0.7415522933006287, 0.744118332862854, 0.7466779947280884,
    0.7492369413375854, 0.7517690658569336, 0.7543134093284607, 0.7569150924682617, 0.7594488859176636,
    0.7619790434837341, 0.7645830512046814, 0.767112135887146, 0.7696208953857422, 0.7721436619758606,
    0.77464759349823, 0.7771546244621277, 0.7796522974967957, 0.7821502685546875, 0.7846465110778809,
    0.7871439456939697, 0.7896320223808289, 0.792110800743103, 0.7945878505706787, 0.7970585823059082,
    0.7995285391807556, 0.8019964098930359, 0.8044551014900208, 0.8069154024124146, 0.8095876574516296,
    0.8120409250259399, 0.8144888281822205, 0.8169368505477905, 0.8193725943565369, 0.8218107223510742,
    0.8242447972297668, 0.8266962766647339, 0.8291221261024475, 0.8315431475639343, 0.8339586853981018,
    0.8363702297210693, 0.838793158531189, 0.8412017226219177, 0.8436049818992615, 0.8460054397583008,
    0.8484020829200745, 0.8507946133613586, 0.8531854152679443, 0.8555680513381958, 0.8579518795013428,
    0.8603296279907227, 0.8627079129219055, 0.8650792837142944, 0.8674538135528564, 0.8698166012763977,
    0.8721835613250732, 0.8745330572128296, 0.8769068121910095, 0.8792752623558044, 0.8816248178482056,
    0.8840077519416809, 0.8863238096237183, 0.8886707425117493, 0.8909978866577148, 0.8933396339416504,
    0.8956670761108398, 0.897991418838501, 0.9003166556358337, 0.9026410579681396, 0.9049557447433472,
    0.9072654247283936, 0.9095936417579651, 0.9119053483009338, 0.914211094379425, 0.9165115356445312,
    0.9188082814216614, 0.9211031794548035, 0.923393964767456, 0.925683319568634, 0.92796790599823,
    0.9302544593811035, 0.9325410723686218, 0.9348147511482239, 0.9370918869972229, 0.939416766166687,
    0.9416704773902893, 0.9439396858215332, 0.9461941719055176, 0.9484590888023376, 0.9507157802581787,
    0.9529711008071899, 0.9552158713340759, 0.9574638605117798, 0.9597135782241821, 0.9619540572166443,
    0.9645050764083862, 0.9667394757270813, 0.9689697623252869, 0.9712017774581909, 0.9734295010566711,
    0.9756539463996887, 0.9779676198959351, 0.9801835417747498, 0.9823973774909973, 0.9846115112304688,
    0.9868198037147522, 0.9890270829200745, 0.9912419319152832, 0.9934441447257996, 0.9956462979316711,
    0.9978431463241577, 1.000038504600525, 1.002229332923889, 1.004420518875122, 1.006603598594666,
    1.008790969848633, 1.010964155197144, 1.013144373893738, 1.015320301055908, 1.01749312877655,
    1.019663691520691, 1.021845459938049, 1.024008989334106, 1.026193737983704, 1.028329968452454,
    1.030483484268188, 1.032634854316711, 1.034784197807312, 1.036911249160767, 1.039081215858459,
    1.041227579116821, 1.043363094329834, 1.045498728752136, 1.047632932662964, 1.049764156341553,
    1.052085876464844, 1.054215788841248, 1.056349873542786, 1.058474063873291, 1.060592412948608,
    1.062713742256165, 1.064832091331482, 1.066897988319397, 1.069054841995239, 1.071162462234497,
    1.073256373405457, 1.075376510620117, 1.07747745513916, 1.079574465751648, 1.081680774688721,
    1.083776593208313, 1.085866451263428, 1.087952971458435, 1.090037941932678, 1.092121362686157,
    1.094200968742371, 1.096286058425903, 1.098374128341675, 1.100456237792969, 1.102538585662842,
    1.104625821113586, 1.106696486473083, 1.108764410018921, 1.11082911491394, 1.112903356552124,
    1.114952564239502, 1.117020726203918, 1.119075894355774, 1.121127128601074, 1.123176336288452,
    1.125225186347961, 1.127273559570312, 1.129307746887207, 1.131354451179504, 1.133393049240112
];

// 核心模型参数
const ModelConfig = {
    years: Array.from({length:141}, (_,i) => 1960 + i), // 1960-2100
    baseConcentration: 363, // 1960年CO2浓度
    naturalDecayRate: 0.005,
    retentionRate: 0.44,
    params: {
        developed: { α: 0.021, β: 0.0008, gdp0: 18000 },
        developing: { α: 0.036, β: 0.0025, gdp0: 800 }
    },
    // 温升模型参数（含科学来源）
    Am: 2.3,        // 大气质量因子 
    AT_val: 6.6,    // 大气透射率
    Kb: 5.670367e-8, // 玻尔兹曼常数 (物理学常数)
    Ts: 288.15      // 地表基准温度 (NASA数据)
};

// 存储全局数据
let globalData = null;

// 获取辐射强迫值
function getForcing(deltaC) {
    // 确保浓度变化在0-400ppm范围内
    deltaC = Math.max(0, Math.min(deltaC, 400));
    
    // 线性插值
    const index = Math.floor(deltaC);
    const fraction = deltaC - index;
    
    if (index >= 399) {
        return forcingData[399];
    }
    
    return forcingData[index] * (1 - fraction) + forcingData[index + 1] * fraction;
}

// 核心计算函数
function calculateModels() {
    const baseEmission = parseFloat(document.getElementById('baseEmission').value);
    const reduction = parseFloat(document.getElementById('reduction').value);
    const countryType = document.getElementById('countryType').value;
    const currentYear = parseInt(document.getElementById('currentYear').value);
    
    // 更新当前年份显示
    document.getElementById('currentYearDisplay').textContent = currentYear;
    
    // 排放计算
    const emissions = {
        policy: ModelConfig.years.map(t => 
            baseEmission * Math.pow(1 - reduction/100, t-1960) * Math.pow(1.01, t-1960)),
        baseline: ModelConfig.years.map(t => 
            baseEmission * Math.pow(1.01, t-1960)
        )
    };
    
    // 浓度计算
    const concentrations = [ModelConfig.baseConcentration];
    for(let i=1; i<ModelConfig.years.length; i++) {
        const decay = ModelConfig.naturalDecayRate * (concentrations[i-1] - 280);
        concentrations.push(concentrations[i-1] + 
            emissions.policy[i] * ModelConfig.retentionRate/2.12 - decay);
    }
    
    // 温度计算（使用辐射强迫模型）
    const temperatures = concentrations.map(c => {
        const deltaC = c - 280; // 相对于工业革命前的浓度变化
        const forcing = getForcing(deltaC);
        return (ModelConfig.Am * ModelConfig.AT_val * forcing) / 
               (4 * ModelConfig.Kb * Math.pow(ModelConfig.Ts, 3));
    });
    
    // 经济计算
    const economy = {
        policy: temperatures.map((Δt, i) => 
            ModelConfig.params[countryType].gdp0 * (1 - 
            ModelConfig.params[countryType].α * Δt - 
            ModelConfig.params[countryType].β * Math.pow(emissions.policy[i], 1.5))),
        baseline: temperatures.map((Δt, i) => 
            ModelConfig.params[countryType].gdp0 * (1 - 
            ModelConfig.params[countryType].α * Δt - 
            ModelConfig.params[countryType].β * Math.pow(emissions.baseline[i], 1.5)))
    };
    
    return { 
        emissions, 
        concentrations, 
        temperatures, 
        economy, 
        currentYear,
        baseEmission,
        reduction,
        countryType
    };
}

// 图表渲染函数
function renderCharts() {
    const data = calculateModels();
    globalData = data; // 保存全局数据
    
    // 获取图表大小设置
    const chartHeight = parseInt(document.getElementById('chartHeightSlider').value);
    const chartWidthPercent = parseInt(document.getElementById('chartWidthSlider').value);
    
    // 更新图表容器大小
    document.querySelectorAll('.chart-container').forEach(container => {
        container.style.height = `${chartHeight}px`;
        container.style.width = `${chartWidthPercent}%`;
    });
    
    // 公共配置
    const layoutCommon = {
        xaxis: { 
            title: '年份', 
            showline: true, 
            linecolor: '#bdc3c7',
            range: [1960, 2100] // 限制X轴范围
        },
        yaxis: { 
            showline: true, 
            linecolor: '#bdc3c7', 
            gridcolor: '#ecf0f1',
            zeroline: false
        },
        plot_bgcolor: '#f8f9fa',
        margin: { t: 50, b: 70, r: 30, l: 70 }, // 调整边距确保文本显示完整
        hovermode: 'x',
        hoverdistance: 100,
        showlegend: true,
        legend: { 
            orientation: 'h', 
            y: -0.2,
            font: { size: 12 }
        },
        font: { family: 'Arial, sans-serif', size: 12 }
    };
    
    // 计算各图表Y轴范围
    const emissionYRange = [0, Math.max(...data.emissions.policy, ...data.emissions.baseline) * 1.1];
    const concentrationYRange = [Math.min(...data.concentrations)*0.98, Math.max(...data.concentrations)*1.02];
    const temperatureYRange = [0, Math.max(...data.temperatures)*1.2];
    const economyYRange = [0, Math.max(...data.economy.policy, ...data.economy.baseline) * 1.1];
    
    // 排放图表
    Plotly.newPlot('emissionChart', [{
        x: ModelConfig.years,
        y: data.emissions.baseline,
        line: { color: '#95a5a6', dash: 'dot', width: 2 },
        name: '基准排放',
        hovertemplate: '%{y:.2f} Gt/yr<extra></extra>'
    },{
        x: ModelConfig.years,
        y: data.emissions.policy,
        line: { color: '#e74c3c', width: 3 },
        name: '政策排放',
        hovertemplate: '%{y:.2f} Gt/yr<extra></extra>'
    },{
        x: [data.currentYear, data.currentYear],
        y: emissionYRange,
        line: { color: '#2c3e50', dash: 'dash', width: 2 },
        name: '当前年份',
        hovertemplate: '当前年份: %{x}<extra></extra>'
    }], Object.assign({}, layoutCommon, {
        title: '',
        yaxis: { title: '排放量 (Gt/yr)', range: emissionYRange }
    }));
    
    // 浓度图表
    Plotly.newPlot('concentrationChart', [{
        x: ModelConfig.years,
        y: data.concentrations,
        line: { color: '#3498db', width: 3 },
        name: 'CO₂浓度',
        hovertemplate: '%{y:.1f} ppm<extra></extra>'
    },{
        x: [data.currentYear, data.currentYear],
        y: concentrationYRange,
        line: { color: '#2c3e50', dash: 'dash', width: 2 },
        name: '当前年份',
        hovertemplate: '当前年份: %{x}<extra></extra>'
    }], Object.assign({}, layoutCommon, {
        title: '',
        yaxis: { title: '浓度 (ppm)', range: concentrationYRange }
    }));
    
    // 温度图表
    Plotly.newPlot('temperatureChart', [{
        x: ModelConfig.years,
        y: data.temperatures,
        line: { color: '#2ecc71', width: 3 },
        name: '全球温升',
        hovertemplate: '%{y:.2f} ℃<extra></extra>'
    },{
        x: [data.currentYear, data.currentYear],
        y: temperatureYRange,
        line: { color: '#2c3e50', dash: 'dash', width: 2 },
        name: '当前年份',
        hovertemplate: '当前年份: %{x}<extra></extra>'
    }], Object.assign({}, layoutCommon, {
        title: '',
        yaxis: { title: '温度变化 (℃)', range: temperatureYRange }
    }));
    
    // 经济图表
    Plotly.newPlot('economyChart', [{
        x: ModelConfig.years,
        y: data.economy.baseline,
        line: { color: '#9b59b6', dash: 'dot', width: 2 },
        name: '基准GDP',
        hovertemplate: '%{y:.0f} 美元<extra></extra>'
    },{
        x: ModelConfig.years,
        y: data.economy.policy,
        line: { color: '#9b59b6', width: 3 },
        name: '政策GDP',
        hovertemplate: '%{y:.0f} 美元<extra></extra>'
    },{
        x: [data.currentYear, data.currentYear],
        y: economyYRange,
        line: { color: '#2c3e50', dash: 'dash', width: 2 },
        name: '当前年份',
        hovertemplate: '当前年份: %{x}<extra></extra>'
    }], Object.assign({}, layoutCommon, {
        title: '',
        yaxis: { title: 'GDP (美元)', range: economyYRange }
    }));
}

// 显示悬停信息
function showHoverInfo(event, chartId, title, valueFormatter) {
    if (!globalData) return;
    
    // 获取鼠标位置
    const rect = event.target.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;
    
    // 计算年份（1960-2100共141年）
    const year = Math.round(1960 + (x / rect.width) * 140);
    if (year < 1960 || year > 2100) return;
    
    const idx = year - 1960;
    const infoBox = document.getElementById(chartId + 'Hover');
    
    // 更新信息框内容
    infoBox.innerHTML = `
        <h4>${title} (${year}年)</h4>
        ${valueFormatter(year, idx)}
    `;
    
    // 定位信息框
    infoBox.style.left = (x + 20) + 'px';
    infoBox.style.top = (y - 50) + 'px';
    infoBox.style.opacity = 1;
}

// 隐藏悬停信息
function hideHoverInfo(chartId) {
    const infoBox = document.getElementById(chartId + 'Hover');
    infoBox.style.opacity = 0;
}

// 事件监听
document.querySelectorAll('input, select').forEach(element => {
    element.addEventListener('input', () => {
        document.getElementById(element.id + 'Val').textContent = element.value;
        renderCharts();
    });
});

// 图表大小控制事件
document.getElementById('chartHeightSlider').addEventListener('input', function() {
    document.getElementById('chartHeightValue').textContent = this.value;
    renderCharts();
});

document.getElementById('chartWidthSlider').addEventListener('input', function() {
    document.getElementById('chartWidthValue').textContent = this.value;
    renderCharts();
});

// 初始化
renderCharts();

// 添加悬停事件
document.querySelectorAll('.chart-container').forEach(container => {
    const chartId = container.id;
    
    container.addEventListener('mousemove', (event) => {
        let title, formatter;
        
        switch(chartId) {
            case 'emissionChart':
                title = '排放量分析';
                formatter = (year, idx) => `
                    <p>政策排放: <span class="hover-value">${globalData.emissions.policy[idx].toFixed(2)} Gt/yr</span></p>
                    <p>基准排放: <span class="hover-value">${globalData.emissions.baseline[idx].toFixed(2)} Gt/yr</span></p>
                    <p>减排率: <span class="hover-value">${globalData.reduction}%/年</span></p>
                `;
                break;
            case 'concentrationChart':
                title = '大气浓度分析';
                formatter = (year, idx) => `
                    <p>CO₂浓度: <span class="hover-value">${globalData.concentrations[idx].toFixed(1)} ppm</span></p>
                    <p>较1960年: <span class="hover-value">+${(globalData.concentrations[idx] - 363).toFixed(1)} ppm</span></p>
                    <p>较工业革命前: <span class="hover-value">+${(globalData.concentrations[idx] - 280).toFixed(1)} ppm</span></p>
                `;
                break;
            case 'temperatureChart':
                title = '温升分析';
                formatter = (year, idx) => {
                    const deltaC = globalData.concentrations[idx] - 280;
                    const forcing = getForcing(deltaC);
                    return `
                        <p>全球温升: <span class="hover-value">${globalData.temperatures[idx].toFixed(2)} ℃</span></p>
                        <p>辐射强迫: <span class="hover-value">${forcing.toFixed(4)} W/m²</span></p>
                        <p>目标安全值: <span class="hover-value">1.5-2.0 ℃</span></p>
                    `;
                };
                break;
            case 'economyChart':
                title = '经济影响分析';
                formatter = (year, idx) => {
                    const loss = 100 - (globalData.economy.policy[idx] / globalData.economy.baseline[idx]) * 100;
                    const tempImpact = globalData.params[globalData.countryType].α * globalData.temperatures[idx] * 100;
                    const emissionImpact = globalData.params[globalData.countryType].β * Math.pow(globalData.emissions.policy[idx], 1.5) * 100;
                    
                    return `
                        <p>政策GDP: <span class="hover-value">${globalData.economy.policy[idx].toFixed(0)} 美元</span></p>
                        <p>基准GDP: <span class="hover-value">${globalData.economy.baseline[idx].toFixed(0)} 美元</span></p>
                        <p>GDP损失: <span class="hover-value">${loss.toFixed(1)}%</span></p>
                        <p>温升影响: <span class="hover-value">-${tempImpact.toFixed(1)}%</span></p>
                        <p>排放影响: <span class="hover-value">-${emissionImpact.toFixed(1)}%</span></p>
                    `;
                };
                break;
        }
        
        showHoverInfo(event, chartId, title, formatter);
    });
    
    container.addEventListener('mouseleave', () => {
        hideHoverInfo(chartId);
    });
});
</script>
</body>
</html>